import { useEffect, useState, useRef } from 'react';
import { useParams, Link } from 'react-router-dom';
import { ShieldCheck, AlertTriangle, FileText, ChevronLeft, Calendar, FlaskConical, Download, QrCode as QrIcon, Settings } from 'lucide-react';
import type { COA } from '../types/coa';
import { PieChart, Pie, Cell, ResponsiveContainer, Tooltip as ReTooltip, Legend } from 'recharts';
import QRCode from "react-qr-code";
import { toPng } from 'html-to-image';
import CVVGenerator from '../components/CVVGenerator';
import COAEnrichmentForm from '../components/COAEnrichmentForm';
// import { useTheme } from '../contexts/ThemeContext';
// import ThemeSelector from '../components/ThemeSelector';

export default function COADetails() {
    const { token } = useParams<{ token: string }>();
    const { colors } = useTheme();
    const [coa, setCoa] = useState<COA | null>(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');
    const [adminMode, setAdminMode] = useState(false); // Toggle for admin panel
    const qrRef = useRef<HTMLDivElement>(null);

    const loadCOA = () => {
        fetch(`http://localhost:3000/api/v1/coas/${token}`)
            .then(res => {
                if (!res.ok) throw new Error('COA not found');
                return res.json();
            })
            .then(data => {
                setCoa(data.data);
                setLoading(false);
            })
            .catch(err => {
                console.error(err);
                setError('No se encontr√≥ el certificado o hubo un error.');
                setLoading(false);
            });
    };

    useEffect(() => {
        loadCOA();
    }, [token]);

    const downloadQR = async () => {
        if (qrRef.current) {
            try {
                const dataUrl = await toPng(qrRef.current, { cacheBust: true, backgroundColor: '#ffffff' });
                const link = document.createElement('a');
                link.download = `EUM-QR-${token}.png`;
                link.href = dataUrl;
                link.click();
            } catch (err) {
                console.error("Failed to download QR", err);
            }
        }
    };

    const handlePrint = () => {
        window.print();
    };

    if (loading) return (
        <div className="min-h-screen bg-gray-900 flex items-center justify-center text-emerald-500">
            <div className="animate-pulse flex flex-col items-center">
                <FlaskConical className="w-10 h-10 mb-2" />
                <span className="text-sm font-medium">Cargando An√°lisis...</span>
            </div>
        </div>
    );

    if (error || !coa) return (
        <div className="min-h-screen bg-gray-900 flex flex-col items-center justify-center text-white p-6">
            <AlertTriangle className="w-12 h-12 text-red-500 mb-4" />
            <h2 className="text-xl font-bold mb-2">Error</h2>
            <p className="text-gray-400 mb-6">{error}</p>
            <Link to="/" className="text-emerald-400 hover:text-emerald-300 flex items-center">
                <ChevronLeft className="w-4 h-4 mr-1" /> Volver al inicio
            </Link>
        </div>
    );

    // Format analysis date
    const formatDate = (dateString?: string) => {
        if (!dateString) return 'Fecha Pendiente';
        try {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-MX', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        } catch (e) {
            return dateString; // Return as-is if parsing fails
        }
    };

    // Calculations
    const totalCannabinoids = coa.cannabinoids.reduce((acc, c) => acc + parseFloat(c.result_pct), 0).toFixed(2);
    // Standard Total THC Formula: THC + (THCA * 0.877)
    const thc = coa.cannabinoids.find(c => c.analyte === 'Delta 9 THC' || c.analyte === 'Delta 9') ? parseFloat(coa.cannabinoids.find(c => c.analyte === 'Delta 9 THC' || c.analyte === 'Delta 9')?.result_pct || '0') : 0;
    const thca = coa.cannabinoids.find(c => c.analyte === 'THCA') ? parseFloat(coa.cannabinoids.find(c => c.analyte === 'THCA')?.result_pct || '0') : 0;
    const totalTHC = (thc + (thca * 0.877)).toFixed(2);

    // Mexico THC compliance: must be <= 1%
    const isTHCCompliant = parseFloat(totalTHC) <= 1.0;

    // Find highest non-THC cannabinoid (excluding Delta 9, Delta 8, THCA)
    const nonTHCCannabinoids = coa.cannabinoids.filter(c =>
        !['Delta 9 THC', 'Delta 9', 'Delta 8', 'THCA'].includes(c.analyte)
    );
    const highestCannabinoid = nonTHCCannabinoids.length > 0
        ? nonTHCCannabinoids.reduce((max, c) =>
            parseFloat(c.result_pct) > parseFloat(max.result_pct) ? c : max
        )
        : null;

    // Chart Data (Top 5 + Others)
    const sortedCannabinoids = [...coa.cannabinoids].sort((a, b) => parseFloat(b.result_pct) - parseFloat(a.result_pct));
    const chartData = sortedCannabinoids.slice(0, 5).map(c => ({
        name: c.analyte,
        value: parseFloat(c.result_pct)
    }));
    if (sortedCannabinoids.length > 5) {
        const others = sortedCannabinoids.slice(5).reduce((acc, c) => acc + parseFloat(c.result_pct), 0);
        chartData.push({ name: 'Otros', value: others });
    }

    const COLORS = ['#10b981', '#34d399', '#6ee7b7', '#a7f3d0', '#d1fae5', '#94a3b8'];

    return (
        <div
            className="min-h-screen font-sans print:bg-white print:text-black"
            style={{ backgroundColor: colors.bgPrimary, color: colors.textPrimary }}
        >

            {/* Navbar */}
            <nav
                className="border-b backdrop-blur sticky top-0 z-10 print:hidden"
                style={{
                    backgroundColor: colors.bgSecondary + '80',
                    borderColor: colors.border
                }}
            >
                <div className="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
                    <Link to="/" className="transition-colors" style={{ color: colors.textSecondary }}>
                        <ChevronLeft className="w-6 h-6" />
                    </Link>
                    <span className="font-bold tracking-wider" style={{ color: colors.accent }}>EUM VERIFIED</span>
                    <div className="flex items-center space-x-3">
                        <ThemeSelector />
                        <button
                            onClick={() => setAdminMode(!adminMode)}
                            className="transition-colors"
                            style={{ color: adminMode ? colors.accent : colors.textSecondary }}
                            title="Panel de Administraci√≥n"
                        >
                            <Settings className="w-5 h-5" />
                        </button>
                        <button
                            onClick={handlePrint}
                            className="transition-colors"
                            style={{ color: colors.textSecondary }}
                        >
                            <Download className="w-5 h-5" />
                        </button>
                    </div>
                </div>
            </nav>

            <main className="max-w-4xl mx-auto p-4 space-y-6 print:space-y-4">

                {/* Header Card */}
                <div
                    className="rounded-2xl p-6 border shadow-xl relative overflow-hidden print:border-none print:shadow-none print:p-0"
                    style={{ backgroundColor: colors.bgSecondary, borderColor: colors.border }}
                >
                    <div className="absolute top-0 right-0 p-4 opacity-30 print:hidden">
                        <ShieldCheck className="w-24 h-24" style={{ color: colors.accent + '30' }} />
                    </div>

                    <div className="relative z-10">
                        <div className="flex items-center space-x-2 mb-2">
                            <span
                                className="px-2 py-0.5 rounded text-xs font-bold uppercase tracking-wide print:border print:border-black print:text-black print:bg-transparent"
                                style={{
                                    backgroundColor: coa.compliance_status === 'pass' ? colors.success + '30' : colors.error + '30',
                                    color: coa.compliance_status === 'pass' ? colors.success : colors.error
                                }}
                            >
                                {coa.compliance_status === 'pass' ? 'TESTED' : (coa.compliance_status || 'UNKNOWN').toUpperCase()}
                            </span>
                            {isTHCCompliant && (
                                <span
                                    className="px-2 py-0.5 rounded text-xs border print:text-black print:border-black print:bg-transparent"
                                    style={{
                                        backgroundColor: colors.success + '20',
                                        color: colors.success,
                                        borderColor: colors.success
                                    }}
                                >
                                    THC Compliant (‚â§1%)
                                </span>
                            )}
                            {!isTHCCompliant && (
                                <span
                                    className="px-2 py-0.5 rounded text-xs border print:text-black print:border-black print:bg-transparent"
                                    style={{
                                        backgroundColor: colors.error + '20',
                                        color: colors.error,
                                        borderColor: colors.error
                                    }}
                                >
                                    THC &gt;1% (No Compliant MX)
                                </span>
                            )}
                        </div>

                        <h1 className="text-3xl font-bold mb-2 print:text-black" style={{ color: colors.textPrimary }}>
                            {coa.custom_name || coa.product_sku || coa.batch_id || 'Certificado de An√°lisis'}
                        </h1>
                        <p className="text-sm flex items-center mb-1 print:text-gray-600" style={{ color: colors.textSecondary }}>
                            <Calendar className="w-3.5 h-3.5 mr-1.5" />
                            {formatDate(coa.analysis_date)} ‚Ä¢ {coa.lab_name}
                        </p>
                        <p className="text-xs mb-6 print:text-gray-500" style={{ color: colors.textSecondary }}>
                            COA: {coa.coa_number || `EUM_${String(coa.id).slice(0, 8).toUpperCase()}_COA`} ‚Ä¢ Token: {token}
                        </p>

                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div
                                className="p-4 rounded-xl border print:border-gray-300 print:bg-gray-100"
                                style={{ backgroundColor: colors.bgCard, borderColor: colors.border }}
                            >
                                <span className="text-xs block mb-1 print:text-gray-600" style={{ color: colors.textSecondary }}>Total Cannabinoides</span>
                                <span className="text-2xl font-bold print:text-black" style={{ color: colors.accent }}>{totalCannabinoids}%</span>
                            </div>
                            <div
                                className="p-4 rounded-xl border print:border-gray-300 print:bg-gray-100"
                                style={{ backgroundColor: colors.bgCard, borderColor: colors.border }}
                            >
                                <span className="text-xs block mb-1 print:text-gray-600" style={{ color: colors.textSecondary }}>Total THC</span>
                                <span className="text-2xl font-bold print:text-black" style={{ color: colors.accent }}>{totalTHC}%</span>
                            </div>
                            {highestCannabinoid && (
                                <div
                                    className="p-4 rounded-xl border print:border-gray-300 print:bg-gray-100"
                                    style={{ backgroundColor: colors.bgCard, borderColor: colors.border }}
                                >
                                    <span className="text-xs block mb-1 print:text-gray-600 truncate" style={{ color: colors.textSecondary }} title={highestCannabinoid.analyte}>
                                        {highestCannabinoid.analyte.length > 15 ? highestCannabinoid.analyte.substring(0, 15) + '...' : highestCannabinoid.analyte}
                                    </span>
                                    <span className="text-2xl font-bold print:text-black" style={{ color: colors.accent }}>{highestCannabinoid.result_pct}%</span>
                                </div>
                            )}
                            <div
                                className="p-4 rounded-xl border print:border-gray-300 print:bg-gray-100 flex flex-col justify-center items-center cursor-pointer group transition"
                                style={{ backgroundColor: colors.bgCard, borderColor: colors.border }}
                                onClick={downloadQR}
                            >
                                <div ref={qrRef} className="bg-white p-2 rounded mb-2">
                                    <QRCode value={`http://localhost:5173/coa/${token}`} size={48} viewBox={`0 0 256 256`} />
                                </div>
                                <span className="text-[10px] flex items-center print:hidden" style={{ color: colors.textSecondary }}>
                                    <Download className="w-3 h-3 mr-1" /> Descargar QR
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                {/* Watermark Background (if exists) */}
                {coa.watermark_url && (
                    <div className="fixed inset-0 flex items-center justify-center pointer-events-none print:absolute print:opacity-10 hidden print:block">
                        <img
                            src={coa.watermark_url}
                            alt="Watermark"
                            className="max-w-md opacity-5 print:opacity-10"
                        />
                    </div>
                )}

                {/* Product Description */}
                {(coa.metadata?.description_short || coa.metadata?.description_extended) && (
                    <div
                        className="rounded-2xl border p-6 print:border-none print:shadow-none"
                        style={{ backgroundColor: colors.bgSecondary, borderColor: colors.border }}
                    >
                        {coa.metadata?.description_short && (
                            <div className="mb-4">
                                <h3 className="font-semibold mb-2 print:text-black" style={{ color: colors.accent }}>Descripci√≥n del Producto</h3>
                                <p className="leading-relaxed print:text-black" style={{ color: colors.textPrimary }}>{coa.metadata.description_short}</p>
                            </div>
                        )}
                        {coa.metadata?.description_extended && (
                            <div>
                                {coa.metadata?.description_short && <h4 className="font-medium mb-2 print:text-gray-700" style={{ color: colors.textSecondary }}>Informaci√≥n Detallada</h4>}
                                <p className="leading-relaxed whitespace-pre-line print:text-gray-800" style={{ color: colors.textSecondary }}>{coa.metadata.description_extended}</p>
                            </div>
                        )}
                    </div>
                )}

                {/* Extended Information - 2 Column Layout */}
                {(coa.product_image_url || coa.metadata?.client_name || coa.metadata?.received_date) && (
                    <div
                        className="rounded-2xl border p-6 print:border-none print:shadow-none"
                        style={{ backgroundColor: colors.bgSecondary, borderColor: colors.border }}
                    >
                        <div className="grid md:grid-cols-2 gap-6">
                            {/* Left Column: Technical Details */}
                            <div className="space-y-4">
                                <h3 className="font-semibold mb-4 print:text-black" style={{ color: colors.textPrimary }}>Informaci√≥n de la Muestra</h3>

                                {coa.metadata?.client_name && (
                                    <div>
                                        <span className="text-xs block mb-1 print:text-gray-600" style={{ color: colors.textSecondary }}>Cliente</span>
                                        <span className="print:text-black" style={{ color: colors.textPrimary }}>{coa.metadata.client_name}</span>
                                    </div>
                                )}

                                {coa.metadata?.client_reference && (
                                    <div>
                                        <span className="text-xs block mb-1 print:text-gray-600" style={{ color: colors.textSecondary }}>Referencia del Cliente</span>
                                        <span className="print:text-black" style={{ color: colors.textPrimary }}>{coa.metadata.client_reference}</span>
                                    </div>
                                )}

                                {coa.metadata?.received_date && (
                                    <div>
                                        <span className="text-xs block mb-1 print:text-gray-600" style={{ color: colors.textSecondary }}>Fecha de Recepci√≥n</span>
                                        <span className="print:text-black" style={{ color: colors.textPrimary }}>
                                            {new Date(coa.metadata.received_date).toLocaleDateString('es-MX')}
                                        </span>
                                    </div>
                                )}

                                {coa.metadata?.sample_condition && (
                                    <div>
                                        <span className="text-xs block mb-1 print:text-gray-600" style={{ color: colors.textSecondary }}>Condici√≥n de Muestra</span>
                                        <span className="print:text-black" style={{ color: colors.textPrimary }}>{coa.metadata.sample_condition}</span>
                                    </div>
                                )}

                                {coa.metadata?.storage_temp && (
                                    <div>
                                        <span className="text-xs block mb-1 print:text-gray-600" style={{ color: colors.textSecondary }}>Temperatura de Almacenamiento</span>
                                        <span className="print:text-black" style={{ color: colors.textPrimary }}>{coa.metadata.storage_temp}</span>
                                    </div>
                                )}

                                {coa.metadata?.storage_time && (
                                    <div>
                                        <span className="text-xs block mb-1 print:text-gray-600" style={{ color: colors.textSecondary }}>Tiempo de Almacenamiento</span>
                                        <span className="print:text-black" style={{ color: colors.textPrimary }}>{coa.metadata.storage_time}</span>
                                    </div>
                                )}

                                {coa.metadata?.container_type && (
                                    <div>
                                        <span className="text-xs block mb-1 print:text-gray-600" style={{ color: colors.textSecondary }}>Tipo de Recipiente</span>
                                        <span className="print:text-black" style={{ color: colors.textPrimary }}>{coa.metadata.container_type}</span>
                                    </div>
                                )}
                            </div>

                            {/* Right Column: Product Image */}
                            {coa.product_image_url && (
                                <div className="flex items-center justify-center">
                                    <div className="relative">
                                        <img
                                            src={coa.product_image_url}
                                            alt="Product"
                                            className="max-h-64 rounded-lg border-2 shadow-lg print:border-gray-400"
                                            style={{ borderColor: colors.border }}
                                        />
                                        <span className="absolute -bottom-6 left-0 right-0 text-center text-xs print:text-gray-600" style={{ color: colors.textSecondary }}>
                                            Imagen del Producto
                                        </span>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                )}

                <div className="grid md:grid-cols-2 gap-6 print:block">
                    {/* Chart */}
                    <div
                        className="rounded-2xl border p-6 flex flex-col items-center justify-center print:border-none print:shadow-none"
                        style={{ backgroundColor: colors.bgSecondary, borderColor: colors.border }}
                    >
                        <h3 className="text-sm font-medium mb-4 self-start" style={{ color: colors.textSecondary }}>Perfil de Cannabinoides</h3>
                        <div className="w-full h-64">
                            <ResponsiveContainer width="100%" height="100%">
                                <PieChart>
                                    <Pie
                                        data={chartData}
                                        cx="50%"
                                        cy="50%"
                                        innerRadius={60}
                                        outerRadius={80}
                                        paddingAngle={5}
                                        dataKey="value"
                                    >
                                        {chartData.map((entry, index) => (
                                            <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} stroke="none" />
                                        ))}
                                    </Pie>
                                    <ReTooltip
                                        contentStyle={{ backgroundColor: colors.bgCard, border: 'none', borderRadius: '8px', color: colors.textPrimary }}
                                        itemStyle={{ color: colors.textPrimary }}
                                    />
                                    <Legend verticalAlign="bottom" height={36} iconType="circle" />
                                </PieChart>
                            </ResponsiveContainer>
                        </div>
                    </div>

                    {/* Cannabinoids Table */}
                    <div
                        className="rounded-2xl border overflow-hidden print:border print:border-gray-300 print:mt-4"
                        style={{ backgroundColor: colors.bgSecondary, borderColor: colors.border }}
                    >
                        <div
                            className="px-6 py-4 border-b flex justify-between items-center print:bg-gray-100 print:border-gray-300"
                            style={{ backgroundColor: colors.bgCard, borderColor: colors.border }}
                        >
                            <h3 className="font-semibold flex items-center print:text-black" style={{ color: colors.textPrimary }}>
                                <FlaskConical className="w-4 h-4 mr-2 print:text-black" style={{ color: colors.accent }} />
                                Resultados Detallados
                            </h3>
                        </div>

                        <div className="divide-y print:divide-gray-300" style={{ borderColor: colors.border }}>
                            {coa.cannabinoids.map((c, idx) => (
                                <div
                                    key={idx}
                                    className="flex justify-between items-center px-6 py-4 transition-colors print:hover:bg-transparent"
                                    style={{ borderColor: colors.border }}
                                >
                                    <div className="flex flex-col">
                                        <span className="font-medium print:text-black" style={{ color: colors.textPrimary }}>{c.analyte}</span>
                                        {c.detected && <span className="text-xs print:text-gray-600" style={{ color: colors.accent + 'cc' }}>Detectado</span>}
                                    </div>
                                    <div className="text-right">
                                        <span className="block text-lg font-bold print:text-black" style={{ color: colors.textPrimary }}>
                                            {c.result_pct}%
                                        </span>
                                        {c.result_mg_g && (
                                            <span className="block text-xs print:text-gray-600" style={{ color: colors.textSecondary }}>
                                                {c.result_mg_g} mg/g
                                            </span>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>

                {/* Purchase Links */}
                {coa.purchase_links && coa.purchase_links.length > 0 && (
                    <div
                        className="rounded-2xl border p-6 print:border print:border-gray-300"
                        style={{ backgroundColor: colors.bgSecondary, borderColor: colors.border }}
                    >
                        <h3 className="font-semibold mb-4 print:text-black" style={{ color: colors.textPrimary }}>¬øD√≥nde Encontrar?</h3>
                        <div className="flex flex-wrap gap-3">
                            {coa.purchase_links.map((link, idx) => {
                                // Ensure URL has protocol
                                const url = link.url.match(/^https?:\/\//) ? link.url : `https://${link.url}`;
                                return (
                                    <a
                                        key={idx}
                                        href={url}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        className="flex items-center px-4 py-2 rounded-lg transition-colors print:bg-white print:text-black print:border print:border-black"
                                        style={{
                                            backgroundColor: colors.accent,
                                            color: colors.accentText
                                        }}
                                    >
                                        üõí {link.label}
                                    </a>
                                );
                            })}
                        </div>
                    </div>
                )}

                {/* Additional Documents */}
                {coa.additional_docs && coa.additional_docs.length > 0 && (
                    <div
                        className="rounded-2xl border p-6 print:border print:border-gray-300"
                        style={{ backgroundColor: colors.bgSecondary, borderColor: colors.border }}
                    >
                        <h3 className="font-semibold mb-4 print:text-black" style={{ color: colors.textPrimary }}>Documentaci√≥n Adicional</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            {coa.additional_docs.map((doc, idx) => (
                                <a
                                    key={idx}
                                    href={doc.url}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="flex items-center justify-between p-3 rounded-lg border transition-colors print:bg-white print:text-black print:border-black"
                                    style={{
                                        backgroundColor: colors.bgCard,
                                        borderColor: colors.border
                                    }}
                                >
                                    <div className="flex items-center">
                                        <FileText className="w-5 h-5 mr-2 print:text-black" style={{ color: colors.accent }} />
                                        <div>
                                            <span className="font-medium print:text-black" style={{ color: colors.textPrimary }}>{doc.type}</span>
                                            <span className="text-xs block print:text-gray-600" style={{ color: colors.textSecondary }}>{doc.filename}</span>
                                        </div>
                                    </div>
                                    <Download className="w-4 h-4 print:hidden" style={{ color: colors.textSecondary }} />
                                </a>
                            ))}
                        </div>
                    </div>
                )}

                {/* Badges */}
                {coa.badges && coa.badges.length > 0 && (
                    <div
                        className="rounded-2xl border p-6 print:border-none"
                        style={{ backgroundColor: colors.bgSecondary, borderColor: colors.border }}
                    >
                        <h3 className="font-semibold mb-4 text-center print:text-black" style={{ color: colors.textPrimary }}>Certificaciones</h3>
                        <div className="flex flex-wrap items-center justify-center gap-6">
                            {coa.badges.map((badge, idx) => (
                                <div key={idx} className="flex flex-col items-center">
                                    <img
                                        src={badge.image_url}
                                        alt={badge.name}
                                        className="max-h-16 object-contain"
                                        title={badge.description || badge.name}
                                    />
                                </div>
                            ))}
                        </div>
                    </div>
                )}

                {/* Admin Panel - CVV Generator */}
                {adminMode && token && (
                    <>
                        <CVVGenerator token={token} />
                        <COAEnrichmentForm coaToken={token} coa={coa} onComplete={loadCOA} />
                    </>
                )}

                {/* Footer Actions */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 print:hidden">
                    <div className="flex flex-col gap-3">
                        {(coa.metadata?.file_urls || (coa.pdf_url_original ? [coa.pdf_url_original] : [])).map((url, idx) => {
                            // Fallback name logic
                            let label = `PDF Original`;
                            if (coa.metadata?.file_urls && coa.metadata.file_urls.length > 1) {
                                label = coa.metadata?.original_filenames?.[idx] || `Parte ${idx + 1}`;
                            }

                            return (
                                <a
                                    key={idx}
                                    href={url}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    className="flex items-center justify-center py-4 rounded-xl transition-colors border font-medium"
                                    style={{
                                        backgroundColor: colors.bgCard,
                                        color: colors.textPrimary,
                                        borderColor: colors.border
                                    }}
                                >
                                    <FileText className="w-5 h-5 mr-2" /> {label}
                                </a>
                            );
                        })}
                    </div>

                    <button
                        onClick={() => window.print()}
                        className="flex items-center justify-center py-4 rounded-xl transition-colors shadow-lg font-medium h-full min-h-[60px]"
                        style={{
                            backgroundColor: colors.accent,
                            color: colors.accentText
                        }}
                    >
                        <Download className="w-5 h-5 mr-2" /> Imprimir / Descargar Certificado
                    </button>
                </div>

            </main>
        </div>
    );
}
